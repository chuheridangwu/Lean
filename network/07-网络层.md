# 网络层
网络层数据包（IP数据包，Packet）由首部、数据2部分组成, 数据：很多时候是由传输层传递下来的数据段（Segment）,有些协议是只工作在网络层，比如ICMP、ARP、IP协议。

◼ 版本（Version）
占4位
0b0100：IPv4
0b0110：IPv6
◼ 首部长度（Header Length）
占4位，二进制乘以4才是最终长度
0b0101：20（最小值）
0b1111：60（最大值）
◼ 区分服务（Differentiated Services Field）
占8位
可以用于提高网络的服务质量（QoS，Quality of Service）


![](../network/imgs/network_45.jpg)

![](../network/imgs/network_46.jpg)


## 分片
互联网协议（IP）允许资料包（英语：Datagram）进行分片（英语：fragmentation，又译分段），将资料包分割成更小的单位。这样的话，当数据包比链路最大传输单元（MTU）大时，就可以被分解为很多的足够小片段，以便能够在其上进行传输。

RFC 1191 描述了“路径MTU发现”，该技术用于确定两台IP主机间的路径MTU，这样就可以避免IP分片。

在Internet协议IPv4版本和较新的IPv6版本中，分片机制的细节和分片机制的整体框架是有所不同的。

* IPv4的分片字段均保存在IP头中，允许路由器对超大的IP数据包进行分片。
* IPv6的分片字段作为标准的扩展头部，没被包含在基本IP头中，IP协议推荐使用“路径MTU发现”来获得整个传输路径的最小MTU，从而避免IP数据包过大而需要分片，并因此不允许路由器进行分片。


![](../network/imgs/network_47.jpg)

![](../network/imgs/network_48.jpg)

![](../network/imgs/network_49.jpg)



## TTL

用来防止数据包不断在IP互联网上面永不终止地循环的一个值，它表示在网络层的数据包在被丢弃前最多能经过的路由器个数，


ttl的作用：防止数据包死循环运输占用流量。
ttl是网络生存时间，数据包每经过一次路由器就会-1,减到0之后路由器就会将这个包丢弃，不再转发这个包。
![](../network/imgs/network_50.jpg)

現代Linux系統稱為tracepath，Windows系統稱為tracert

MAC电脑可以通过 traceroute的查看当前主机到目标主机经过的路径。命令`traceroute hostname`

通过traceroute我们可以知道信息从你的计算机到互联网另一端的主机是走的什么路径。当然每次数据包由某一同样的出发点（source）到达某一同样的目的地(destination)走的路径可能会不一样，但基本上来说大部分时候所走的路由是相同的。linux系统中，我们称之为traceroute。

traceroute通过发送小的数据包到目的设备直到其返回，来测量其需要多长时间。一条路径上的每个设备traceroute要测3次。输出结果中包括每次测试的时间(ms)和设备的名称（如有的话）及其IP地址。


Linux
ping
ping 基于 ICMP 协议。利用“ping”命令可以检查网络是否连通，可以很好地帮助我们分析和判定网络故障。

traceroute
traceroute 命令利用 ICMP 协议定位源计算机和目标计算机之间的所有路由器。TTL 值可以反映数据包经过的路由器或网关的数量，通过操纵独立ICMP 呼叫报文的TTL 值和观察该报文被抛弃的返回信息，traceroute 命令能够遍历到数据包传输路径上的所有路由器。

mtr（my traceroute）
mtr 是 Linux中的一个网络连通性判断工具，它结合了ping，traceroute，nslookup 的相关特性。

nslookup
nslookup 可以指定查询的类型，可以查到DNS记录的生存时间，还可以指定使用哪个DNS服务器进行解释。

route
route 命令用于显示和操作IP路由表。

iptables
netfilter/iptables（简称为iptables）组成Linux平台下的包过滤防火墙，与大多数的Linux软件一样，这个包过滤防火墙是免费的，它可以代替昂贵的商业防火墙解决方案，完成封包过滤、封包重定向和网络地址转换（NAT）等功能。
Windows
ping
同 Linux 下的 ping

tracert
同 Linux 下的 traceroute

pathping
类似于 Linux 下的 mtr

nslookup
同 Linux 下的 nslookup

route
类似于 Linux 下的 route
相关阅读： Windows基本路由配置(cmd/route)

netsh
netsh(Network Shell) 是一个 Windows 系统本身提供的网络配置命令行工具。 可用于配置 DNS，实现端口转发等功能。