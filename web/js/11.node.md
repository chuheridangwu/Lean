# Node.js
NodeJS不是一门编程语言，是一个运行环境。这个运行环境由于集成了V8引擎，所以可以运行编写的JS代码，node运行环境最大的特点是提供了操作系统底层API的功能，通过底层API可以编写网页中无法实现的功能（打包、网站服务器等）。使用`node xxx.js` 可以运行js文件或者在命令行输入`node`进入node环境。

`nvm` 和 `n` 可以切换node的版本
node全局当对象是`global`

argc: 传递参数的个数
argv: 传入的具体参数
```javascript
// 打印传递的参数 结果为数组 node hello.js
console.log(process.argv)
/*
[
  '/opt/homebrew/Cellar/node/20.5.1/bin/node',
  '/Users/xxx/Desktop/projects/module/hello.js',
  '123'
]
*/
```

## path/http/fs
`__dirname`: 当前项目路径 /Users/xxx/Desktop/projects
`__filename`: 当前项目路径 + 文件名称 /Users/xxx/Desktop/projects/helloworld.js

NodeJS核心库：
```javascript
const fs = require('fs') //处理文件
const path = require('path') //处理路径
const http = require('http') //web服务器
const buffer = require('buffer') //处理二进制数据

console.log(path.basename("a/c/b.index.html")) //index.html
console.log(path.basename("a/c/b.index.html",".html")) //index
console.log(path.extname(fpath)) //.html
```

Web服务器
```javascript
const http = require('http')
const path = require('path')
const fs = require('fs')
// 创建 web 服务器实例
const serve = http.createServer()
// 绑定 request 事件，监听客户端请求
serve.on('request',function(req,res){
    const url = req.url
    const method = req.method

    // 默认404
    let content = '<h1>404 Not found!</h1>'

    // 判断用户请求是否是首页
    if (url === '/' || url === '/index.html') {
        content = '<h1>首页</h1>'
    } 

    //  解决中文乱码问题
    res.setHeader('Content-Type','text/html','charset=utf-8')

    res.end(content)
})
// 启动服务器
serve.listen(8080,function(){
    console.log('server running at http://127.0.0.1');
})
```


NodeJS环境和浏览器一样都是一个JS的运行环境，都可以执行JS代码，但是由于宿主不同，所以特点也不同：
1. 浏览器环境提供`window`全局对象，NodeJS环境提供`global`全局对象
2. 浏览器环境全局this默认指向`window`，NodeJS环境全局this默认指向空对象`{}`
3. 浏览器环境提供了操作了跟DOM/BOM相关的API,NodeJS环境中没有DOM/BOM

## 安装
[NodeJS下载地址](https://nodejs.org/en/download/),Windows中的.exe文件可以直接安装。Mac OS系统使用`brew install node`进行安装。

**Linux 上安装 Node.js**

```shell
# wget https://nodejs.org/dist/v10.9.0/node-v10.9.0-linux-x64.tar.xz    // 下载
# tar xf  node-v10.9.0-linux-x64.tar.xz       // 解压
# cd node-v10.9.0-linux-x64/                  // 进入解压目录
# ./bin/node -v                               // 执行node命令 查看版本
v10.9.0
```
解压文件的 bin 目录底下包含了 node、npm 等命令，我们可以使用 ln 命令来设置软连接：

```shell
ln -s /usr/software/nodejs/bin/npm   /usr/local/bin/ 
ln -s /usr/software/nodejs/bin/node   /usr/local/bin/
```


## Buffer
Buffer 库为 Node.js 带来了一种存储原始数据的方法，可以让 Node.js 处理二进制数据，当需要在 Node.js 中处理I/O操作中移动的数据时，就有可能使用 Buffer 库。原始数据存储在 Buffer 类的实例中。一个 Buffer 类似于一个整数数组，但它对应于 V8 堆内存之外的一块原始内存。

**Buffer 提供了以下 API 来创建 Buffer 类：**
* `Buffer.alloc(size[, fill[, encoding]])：` 返回一个指定大小的 Buffer 实例，如果没有设置 fill，则默认填满 0
* `Buffer.allocUnsafe(size)：` 返回一个指定大小的 Buffer 实例，但是它不会被初始化，所以它可能包含敏感的数据
* Buffer.allocUnsafeSlow(size)
* `Buffer.from(array)：` 返回一个被 array 的值初始化的新的 Buffer 实例（传入的 array 的元素只能是数字，不然就会自动被 0 覆盖）
* `Buffer.from(arrayBuffer[, byteOffset[, length]])：` 返回一个新建的与给定的 ArrayBuffer 共享同一内存的 Buffer。
* `Buffer.from(buffer)：` 复制传入的 Buffer 实例的数据，并返回一个新的 Buffer 实例
* `Buffer.from(string[, encoding])：` 返回一个被 string 的值初始化的新的 Buffer 实例

## NodeJS 发动邮件
使用 nodeJS 发送邮件，需要使用`npm install nodemailer`安装`nodemailer`库。然后再对应的163邮箱中开启IMAP和POP3服务，配置163邮箱对应的授权密码管理。
```javascript
var nodemailer = require("nodemailer")

var transport = nodemailer.createTransport({
    host:"smtp.163.com", // 主机，在设置里面可以看到
    secureConnection:true, //使用SSL
    port:465,  //STMP端口号
    auth:{
        user:"xxx@163.com",
        pass:"xxx"  //设备密码
    }
})

var mailOptions = {
    from:"xxx@163.com", //发件人
    to:"xxx@qq.com",    // 收件人
    subject:"测试邮件",  //邮件标题
    text:"这是一封测试邮件", // 邮件内容
    html:"<b>helloworld<b>", // 使用html的格式发送邮件，优先级>text
    attachments:[
        {
            filename:"text",
            path:"./app.img" // 文件路径
        },
        {
            filename:"text1", // 文件名
            content:"test" //自己写文件内容
        }
    ]
}

transport.sendMail(mailOptions,function(err,response){
    if(err) console.log(err)
    else console.log(response)
})
```

## NodeJS学习网址
* [nodejs中文网](http://nodejs.cn/learn)
* [菜鸟教程](https://www.runoob.com/nodejs/nodejs-tutorial.html)

基于Express框架 构建web应用，基于Electron框架 做跨平台应用，基于restify框架做api接口项目